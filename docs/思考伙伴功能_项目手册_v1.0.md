# å„¿ç«¥AIå­¦ä¹ ç¡¬ä»¶ - æ¯æ—¥æ€»ç»“åŠŸèƒ½ é¡¹ç›®æ‰‹å†Œ

**ç‰ˆæœ¬**ï¼š1.0 | **åˆ›å»ºæ—¥æœŸ**ï¼š2025å¹´1æœˆ15æ—¥ | **æ ¸å¿ƒ**ï¼šä¸¥æ ¼æŒ‰æ­¤è§„èŒƒå¼€å‘

---

## ç›®å½•

1. [é¡¹ç›®æ ¸å¿ƒè§„èŒƒ](#ä¸€é¡¹ç›®æ ¸å¿ƒè§„èŒƒ)
2. [è¯¦ç»†è®¾è®¡æ–‡æ¡£](#äºŒè¯¦ç»†è®¾è®¡æ–‡æ¡£)
   - 2.1 [æ•°æ®é‡‡é›†å±‚è®¾è®¡](#21-æ•°æ®é‡‡é›†å±‚è®¾è®¡)
   - 2.2 [å­˜å‚¨å±‚è®¾è®¡](#22-å­˜å‚¨å±‚è®¾è®¡)
   - 2.3 [åˆ†æå±‚è®¾è®¡](#23-åˆ†æå±‚è®¾è®¡)
   - 2.4 [æ€»ç»“ç”Ÿæˆå±‚è®¾è®¡](#24-æ€»ç»“ç”Ÿæˆå±‚è®¾è®¡)
   - 2.5 [å¯è§†åŒ–è®¾è®¡](#25-å¯è§†åŒ–è®¾è®¡)
3. [MVPå¼€å‘è·¯çº¿å›¾](#ä¸‰mvpå¼€å‘è·¯çº¿å›¾)
4. [æ–‡ä»¶ç»“æ„çº¦å®š](#å››æ–‡ä»¶ç»“æ„çº¦å®š)
5. [å¼€å‘çºªå¾‹](#äº”å¼€å‘çºªå¾‹)

---

## ä¸€ã€é¡¹ç›®æ ¸å¿ƒè§„èŒƒ

### 1.1 æ¶æ„åŸåˆ™
- âœ… **äº”å±‚æ¶æ„ä¸¥æ ¼éµå®ˆ**ï¼šäº¤äº’å±‚ â†’ é‡‡é›†å±‚ â†’ å­˜å‚¨å±‚ â†’ åˆ†æå±‚ â†’ ç”Ÿæˆå±‚
- âœ… **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¯å±‚ç‹¬ç«‹æ¥å£ï¼Œå¯æ›¿æ¢å®ç°
- âœ… **æ¸è¿›å¼å¼€å‘**ï¼šä»MVP 0.1 â†’ 0.5 â†’ 1.0ï¼Œæ¯ä¸ªé˜¶æ®µå¯ç‹¬ç«‹éªŒè¯
- âœ… **æ•°æ®ä¼˜å…ˆ**ï¼šæ‰€æœ‰åˆ†æåŸºäºçœŸå®æ•°æ®ï¼Œä¸ä¾èµ–è§„åˆ™å‡è®¾

### 1.2 æŠ€æœ¯åŸåˆ™
- âœ… **è½»é‡çº§ä¼˜å…ˆ**ï¼šESP32ç«¯ä»£ç <50KBï¼Œå†…å­˜å ç”¨<100KB
- âœ… **ç¦»çº¿å‹å¥½**ï¼šæœ¬åœ°ç¼“å­˜æ”¯æŒï¼Œç½‘ç»œæ¢å¤åè‡ªåŠ¨åŒæ­¥
- âœ… **éšç§ä¿æŠ¤**ï¼šé»˜è®¤åŒ¿ååŒ–ï¼Œå®¶é•¿æˆæƒåæ‰ä¸Šä¼ 
- âœ… **å®æ—¶å“åº”**ï¼šé—®é¢˜è®°å½•å»¶è¿Ÿ<500msï¼Œæ€»ç»“ç”Ÿæˆ<30s

### 1.3 äº§å“åŸåˆ™
- âœ… **ä¿æŠ¤å¥½å¥‡å¿ƒ**ï¼šæ¯ä¸ªé—®é¢˜éƒ½è¢«è®¤çœŸå¯¹å¾…
- âœ… **çœ‹è§è¿‡ç¨‹**ï¼šä¸åªå…³æ³¨"å­¦åˆ°ä»€ä¹ˆ"ï¼Œæ›´å…³æ³¨"æ€ä¹ˆæ€è€ƒ"
- âœ… **ä¿ƒè¿›äº’åŠ¨**ï¼šä¸ºå®¶é•¿æä¾›å¯æ“ä½œçš„æ´å¯Ÿå’Œå»ºè®®
- âœ… **é¿å…è¯„åˆ¤**ï¼šä¸ç»™å­©å­è´´æ ‡ç­¾ï¼Œä¸æ¯”è¾ƒä¼˜åŠ£

---

## äºŒã€è¯¦ç»†è®¾è®¡æ–‡æ¡£

## 2.1 æ•°æ®é‡‡é›†ä¸å­˜å‚¨å±‚è®¾è®¡

### ä¸€ã€æœ€å°æ•°æ®å­—æ®µå®šä¹‰

ä¸ºäº†ä¿è¯åç»­æ¯æ—¥æ€»ç»“åˆ†æçš„å®Œæ•´æ€§ï¼ŒåŒæ—¶éµå¾ªæ•°æ®æœ€å°åŒ–åŸåˆ™ï¼Œä»¥ä¸‹æ˜¯å¿…é¡»é‡‡é›†çš„æœ€å°å­—æ®µé›†åˆï¼š

| å­—æ®µç±»åˆ« | å­—æ®µåç§° | æ•°æ®ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|---------|---------|---------|------|------|--------|
| **åŸºç¡€æ ‡è¯†** | question_id | UUID | âœ… | é—®é¢˜å”¯ä¸€æ ‡è¯† | "550e8400-e29b-41d4-a716-446655440000" |
| | child_id | VARCHAR(50) | âœ… | å­©å­åŒ¿åID | "child_a3f7c2e1" |
| | device_id | VARCHAR(50) | âœ… | è®¾å¤‡å”¯ä¸€æ ‡è¯† | "ESP32_001234" |
| | timestamp | TIMESTAMP | âœ… | Unixæ—¶é—´æˆ³ | 1705300200 |
| **é—®é¢˜å†…å®¹** | question_text | TEXT | âœ… | é—®é¢˜åŸæ–‡ï¼ˆæœ€å¤š500å­—ï¼‰ | "ä¸ºä»€ä¹ˆå¤©ç©ºæ˜¯è“è‰²çš„ï¼Ÿ" |
| | audio_url | VARCHAR(512) | âŒ | éŸ³é¢‘æ–‡ä»¶URLï¼ˆå¯é€‰ï¼‰ | "s3://audio/q_001.opus" |
| | emotion | VARCHAR(20) | âŒ | å­©å­æƒ…ç»ªæ ‡è¯† | "curious" / "confused" |
| **ä¼šè¯ä¸Šä¸‹æ–‡** | session_id | UUID | âœ… | ä¼šè¯IDï¼ˆåŒä¸€æ¬¡äº¤äº’ï¼‰ | "session_uuid_v4" |
| | is_follow_up | BOOLEAN | âœ… | æ˜¯å¦ä¸ºè¿½é—® | true / false |
| | chain_depth | INT | âœ… | è¿½é—®é“¾æ·±åº¦ï¼ˆ1-Nï¼‰ | 3 |
| | previous_topic | VARCHAR(100) | âŒ | ä¸Šä¸€ä¸ªè¯é¢˜ | "å¤©æ°”" |
| **è‡ªåŠ¨åˆ†æ** | question_type | VARCHAR(10) | âŒ | é—®é¢˜ç±»å‹ | "why" / "what" / "how" |
| | main_category | VARCHAR(50) | âŒ | ä¸»åˆ†ç±»ï¼ˆ7å¤§ç±»ï¼‰ | "ç§‘å­¦" |
| | sub_categories | TEXT[] | âŒ | å­åˆ†ç±»åˆ—è¡¨ | ["ç‰©ç†", "è‡ªç„¶"] |
| | keywords | TEXT[] | âœ… | å…³é”®è¯ï¼ˆ3-5ä¸ªï¼‰ | ["å¤©ç©º", "è“è‰²", "å…‰çº¿"] |
| | cognitive_level | INT | âŒ | è®¤çŸ¥å±‚æ¬¡ï¼ˆ1-5çº§ï¼‰ | 3 |
| | complexity_score | FLOAT | âŒ | å¤æ‚åº¦ï¼ˆ0-1ï¼‰ | 0.6 |
| | interest_score | FLOAT | âŒ | å…´è¶£åº¦ï¼ˆ0-1ï¼‰ | 0.8 |
| **AIå›å¤** | response_text | TEXT | âŒ | AIå›å¤åŸæ–‡ | "è¿™æ˜¯å› ä¸ºé˜³å…‰ç©¿è¿‡å¤§æ°”å±‚æ—¶..." |
| | response_audio_url | VARCHAR(512) | âŒ | å›å¤éŸ³é¢‘URL | "s3://audio/r_001.opus" |
| | follow_up_suggestions | TEXT[] | âŒ | è¿½é—®å»ºè®®åˆ—è¡¨ | ["é‚£ä½ çŸ¥é“æ™šéœä¸ºä»€ä¹ˆæ˜¯çº¢è‰²çš„å—ï¼Ÿ"] |
| **å…ƒæ•°æ®** | created_at | TIMESTAMP | âœ… | è®°å½•åˆ›å»ºæ—¶é—´ | 2025-01-15 10:30:00 |
| | updated_at | TIMESTAMP | âœ… | è®°å½•æ›´æ–°æ—¶é—´ | 2025-01-15 10:30:05 |

**å­—æ®µé‡‡é›†ä¼˜å…ˆçº§**ï¼š
- **MVP 0.1é˜¶æ®µ**ï¼ˆå¿…å¡«å­—æ®µï¼‰ï¼šquestion_id, child_id, device_id, timestamp, question_text, session_id, is_follow_up, chain_depth, keywords, created_at, updated_at
- **MVP 0.5é˜¶æ®µ**ï¼ˆå¢åŠ åˆ†æå­—æ®µï¼‰ï¼šquestion_type, main_category, sub_categories, cognitive_level, complexity_score, interest_score
- **MVP 0.8+é˜¶æ®µ**ï¼ˆå®Œå–„å­—æ®µï¼‰ï¼šemotion, previous_topic, response_text, follow_up_suggestions

---

### äºŒã€æ•°æ®è¡¨ç»“æ„è®¾è®¡

ä¸ºäº†æ¸…æ™°åŒºåˆ†"å¯¹è¯è®°å½•"å’Œ"çŸ¥è¯†å›¾è°±"ï¼Œæˆ‘ä»¬å°†æ•°æ®è¡¨åˆ†ä¸ºä¸¤å¤§ç±»ï¼š

#### 2.1 å¯¹è¯è®°å½•è¡¨ï¼ˆquestionsï¼‰

å­˜å‚¨æ‰€æœ‰é—®ç­”äº¤äº’è®°å½•ï¼Œæ˜¯æ¯æ—¥æ€»ç»“çš„æ ¸å¿ƒæ•°æ®æºã€‚

```sql
-- ========== é—®é¢˜è¡¨ ==========
CREATE TABLE questions (
    -- ä¸»é”®ä¸æ ‡è¯†
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    question_id VARCHAR(50) UNIQUE NOT NULL,  -- UUIDå­—ç¬¦ä¸²
    child_id VARCHAR(50) NOT NULL,
    device_id VARCHAR(50) NOT NULL,

    -- é—®é¢˜å†…å®¹
    question_text TEXT NOT NULL CHECK (length(question_text) <= 500),
    audio_url VARCHAR(512),
    emotion VARCHAR(20),  -- curious/excited/confused/surprised

    -- æ—¶é—´ä¿¡æ¯
    timestamp TIMESTAMP NOT NULL DEFAULT NOW(),

    -- ä¼šè¯ä¸Šä¸‹æ–‡
    session_id UUID NOT NULL,
    is_follow_up BOOLEAN DEFAULT false,
    chain_depth INT DEFAULT 1 CHECK (chain_depth >= 1),
    previous_topic VARCHAR(100),

    -- è‡ªåŠ¨åˆ†æå­—æ®µï¼ˆMVP 0.5+ï¼‰
    question_type VARCHAR(10),  -- what/why/how/who/where/when/compare
    main_category VARCHAR(50),  -- ç§‘å­¦/æŠ€æœ¯/è‰ºæœ¯/æ–‡å­¦/ç¤¾ä¼š/æƒ…æ„Ÿ/ç”Ÿæ´»
    sub_categories TEXT[],      -- å­åˆ†ç±»æ•°ç»„
    keywords TEXT[],            -- å…³é”®è¯æ•°ç»„ï¼ˆå¿…å¡«ï¼Œè‡³å°‘3ä¸ªï¼‰
    cognitive_level INT,        -- 1-5çº§è®¤çŸ¥å±‚æ¬¡
    complexity_score FLOAT,     -- 0-1å¤æ‚åº¦åˆ†æ•°
    interest_score FLOAT,       -- 0-1å…´è¶£åº¦åˆ†æ•°

    -- AIå›å¤ï¼ˆMVP 0.8+ï¼‰
    response_text TEXT,
    response_audio_url VARCHAR(512),
    follow_up_suggestions TEXT[],

    -- å…ƒæ•°æ®
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),

    -- çº¦æŸ
    CONSTRAINT valid_question_type CHECK (
        question_type IS NULL OR
        question_type IN ('what', 'why', 'how', 'who', 'where', 'when', 'compare')
    ),
    CONSTRAINT valid_category CHECK (
        main_category IS NULL OR
        main_category IN ('ç§‘å­¦', 'æŠ€æœ¯', 'è‰ºæœ¯', 'æ–‡å­¦', 'ç¤¾ä¼š', 'æƒ…æ„Ÿ', 'ç”Ÿæ´»')
    ),
    CONSTRAINT valid_emotion CHECK (
        emotion IS NULL OR
        emotion IN ('curious', 'excited', 'confused', 'surprised')
    )
);

-- ========== ç´¢å¼•è®¾è®¡ ==========

-- 1. ä¸»æŸ¥è¯¢ç´¢å¼•ï¼šè·å–å­©å­æŸå¤©çš„é—®é¢˜
CREATE INDEX idx_questions_child_timestamp
ON questions(child_id, timestamp DESC);

-- 2. ä¼šè¯æŸ¥è¯¢ç´¢å¼•ï¼šæŒ‰ä¼šè¯IDæŸ¥è¯¢æ‰€æœ‰é—®é¢˜
CREATE INDEX idx_questions_session
ON questions(session_id, timestamp);

-- 3. åˆ†ç±»ç´¢å¼•ï¼šæŒ‰é¢†åŸŸåˆ†ç±»æŸ¥è¯¢
CREATE INDEX idx_questions_category
ON questions(main_category, timestamp DESC);

-- 4. é—®é¢˜ç±»å‹ç´¢å¼•
CREATE INDEX idx_questions_type
ON questions(question_type, timestamp DESC);

-- 5. å…³é”®è¯å…¨æ–‡ç´¢å¼•ï¼ˆGINç´¢å¼•ï¼Œæ”¯æŒæ•°ç»„æœç´¢ï¼‰
CREATE INDEX idx_questions_keywords
ON questions USING GIN(keywords);

-- 6. è¿½é—®æ·±åº¦ç´¢å¼•ï¼šæ£€æµ‹æ·±åº¦è¿½é—®
CREATE INDEX idx_questions_chain_depth
ON questions(child_id, chain_depth DESC, timestamp DESC);

-- 7. éƒ¨åˆ†ç´¢å¼•ï¼šåªç´¢å¼•æœ€è¿‘30å¤©æ•°æ®ï¼ˆä¼˜åŒ–æ€§èƒ½ï¼‰
CREATE INDEX idx_questions_recent
ON questions(child_id, timestamp DESC)
WHERE timestamp > NOW() - INTERVAL '30 days';

-- 8. è®¾å¤‡ç´¢å¼•ï¼šæŒ‰è®¾å¤‡æŸ¥è¯¢
CREATE INDEX idx_questions_device
ON questions(device_id, timestamp DESC);

-- ========== è‡ªåŠ¨è§¦å‘å™¨ ==========

-- è‡ªåŠ¨æ›´æ–° updated_at å­—æ®µ
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_questions_updated_at
BEFORE UPDATE ON questions
FOR EACH ROW
EXECUTE FUNCTION update_updated_at_column();
```

#### 2.2 çŸ¥è¯†å›¾è°±èŠ‚ç‚¹è¡¨ï¼ˆknowledge_nodesï¼‰

å­˜å‚¨ä»é—®é¢˜ä¸­æå–çš„çŸ¥è¯†èŠ‚ç‚¹ï¼ˆæ¦‚å¿µ/å®ä½“ï¼‰ï¼Œç”¨äºæ„å»ºçŸ¥è¯†å›¾è°±ã€‚

```sql
-- ========== çŸ¥è¯†èŠ‚ç‚¹è¡¨ ==========
CREATE TABLE knowledge_nodes (
    -- ä¸»é”®ä¸æ ‡è¯†
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    child_id VARCHAR(50) NOT NULL,

    -- èŠ‚ç‚¹å±æ€§
    label VARCHAR(100) NOT NULL,      -- èŠ‚ç‚¹æ ‡ç­¾ï¼ˆæ¦‚å¿µåç§°ï¼‰
    category VARCHAR(50),             -- æ‰€å±é¢†åŸŸåˆ†ç±»
    aliases TEXT[],                    -- åˆ«ååˆ—è¡¨ï¼ˆåŒä¹‰è¯ï¼‰

    -- ç»Ÿè®¡ä¿¡æ¯
    visit_count INT DEFAULT 1,        -- è¢«æé—®æ¬¡æ•°
    avg_depth FLOAT,                  -- å¹³å‡è¿½é—®æ·±åº¦
    last_visit TIMESTAMP,             -- æœ€åè®¿é—®æ—¶é—´

    -- æŒæ¡ç¨‹åº¦ï¼ˆ0-1ï¼Œç”±AIè¯„ä¼°ï¼‰
    mastery_level FLOAT DEFAULT 0.3,

    -- å…ƒæ•°æ®
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),

    -- çº¦æŸï¼šåŒä¸€å­©å­çš„åŒä¸€æ¦‚å¿µå”¯ä¸€
    UNIQUE(child_id, label)
);

-- ========== èŠ‚ç‚¹è¡¨ç´¢å¼• ==========

-- 1. å­©å­èŠ‚ç‚¹æŸ¥è¯¢ï¼šæŒ‰è®¿é—®æ¬¡æ•°æ’åº
CREATE INDEX idx_knowledge_nodes_child_visits
ON knowledge_nodes(child_id, visit_count DESC);

-- 2. ç±»åˆ«æŸ¥è¯¢ï¼šæŒ‰é¢†åŸŸåˆ†ç±»æŸ¥è¯¢èŠ‚ç‚¹
CREATE INDEX idx_knowledge_nodes_category
ON knowledge_nodes(child_id, category, visit_count DESC);

-- 3. æŒæ¡ç¨‹åº¦æŸ¥è¯¢ï¼šæ‰¾è–„å¼±çŸ¥è¯†ç‚¹
CREATE INDEX idx_knowledge_nodes_mastery
ON knowledge_nodes(child_id, mastery_level ASC);

-- 4. æ—¶é—´æŸ¥è¯¢ï¼šæœ€è¿‘è®¿é—®çš„çŸ¥è¯†ç‚¹
CREATE INDEX idx_knowledge_nodes_recent
ON knowledge_nodes(child_id, last_visit DESC);

-- 5. åˆ«åæœç´¢ï¼ˆæ”¯æŒåŒä¹‰è¯æŸ¥è¯¢ï¼‰
CREATE INDEX idx_knowledge_nodes_aliases
ON knowledge_nodes USING GIN(aliases);

-- ========== è‡ªåŠ¨è§¦å‘å™¨ ==========

CREATE TRIGGER update_knowledge_nodes_updated_at
BEFORE UPDATE ON knowledge_nodes
FOR EACH ROW
EXECUTE FUNCTION update_updated_at_column();

-- èŠ‚ç‚¹è®¿é—®ç»Ÿè®¡è§¦å‘å™¨
CREATE OR REPLACE FUNCTION update_node_stats()
RETURNS TRIGGER AS $$
BEGIN
    NEW.visit_count = COALESCE(OLD.visit_count, 0) + 1;
    NEW.last_visit = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_node_visits
BEFORE INSERT OR UPDATE ON knowledge_nodes
FOR EACH ROW
EXECUTE FUNCTION update_node_stats();
```

#### 2.3 çŸ¥è¯†å›¾è°±å…³ç³»è¡¨ï¼ˆknowledge_edgesï¼‰

å­˜å‚¨çŸ¥è¯†èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œæ„å»ºæœ‰å‘å›¾ã€‚

```sql
-- ========== çŸ¥è¯†å…³ç³»è¡¨ ==========
CREATE TABLE knowledge_edges (
    -- ä¸»é”®ä¸æ ‡è¯†
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    child_id VARCHAR(50) NOT NULL,

    -- å…³ç³»è¿æ¥
    source_node_id UUID NOT NULL REFERENCES knowledge_nodes(id) ON DELETE CASCADE,
    target_node_id UUID NOT NULL REFERENCES knowledge_nodes(id) ON DELETE CASCADE,

    -- å…³ç³»å±æ€§
    relation_type VARCHAR(50),        -- å…³ç³»ç±»å‹ï¼šå› æœ/åŒ…å«/å¯¹æ¯”/ç›¸å…³
    strength FLOAT DEFAULT 1.0,       -- å…³ç³»å¼ºåº¦ï¼ˆ0-1ï¼‰

    -- æ¥æºè¿½è¸ª
    source_question_id UUID REFERENCES questions(id) ON DELETE SET NULL,

    -- å…ƒæ•°æ®
    created_at TIMESTAMP DEFAULT NOW(),

    -- çº¦æŸ
    CONSTRAINT valid_relation_type CHECK (
        relation_type IS NULL OR
        relation_type IN ('å› æœ', 'åŒ…å«', 'å¯¹æ¯”', 'ç›¸å…³', 'æ–¹æ³•', 'å±æ€§')
    ),
    CONSTRAINT valid_strength CHECK (strength >= 0 AND strength <= 1)
);

-- ========== å…³ç³»è¡¨ç´¢å¼• ==========

-- 1. å­©å­å…³ç³»æŸ¥è¯¢ï¼šæŒ‰å­©å­æŸ¥è¯¢æ‰€æœ‰å…³ç³»
CREATE INDEX idx_knowledge_edges_child
ON knowledge_edges(child_id, strength DESC);

-- 2. èŠ‚ç‚¹å‡ºåº¦æŸ¥è¯¢ï¼šæŸ¥è¯¢èŠ‚ç‚¹çš„è¾“å‡ºå…³ç³»
CREATE INDEX idx_knowledge_edges_source
ON knowledge_edges(source_node_id, strength DESC);

-- 3. èŠ‚ç‚¹å…¥åº¦æŸ¥è¯¢ï¼šæŸ¥è¯¢èŠ‚ç‚¹çš„è¾“å…¥å…³ç³»
CREATE INDEX idx_knowledge_edges_target
ON knowledge_edges(target_node_id, strength DESC);

-- 4. å…³ç³»ç±»å‹æŸ¥è¯¢ï¼šæŒ‰ç±»å‹æŸ¥è¯¢å…³ç³»
CREATE INDEX idx_knowledge_edges_type
ON knowledge_edges(child_id, relation_type);
```

#### 2.4 æ¯æ—¥ä¼šè¯æ±‡æ€»è¡¨ï¼ˆdaily_sessionsï¼‰

é¢„è®¡ç®—çš„æ¯æ—¥ç»Ÿè®¡æ•°æ®ï¼ŒåŠ é€ŸæŸ¥è¯¢ã€‚

```sql
-- ========== æ¯æ—¥ä¼šè¯æ±‡æ€»è¡¨ ==========
CREATE TABLE daily_sessions (
    -- ä¸»é”®
    session_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    child_id VARCHAR(50) NOT NULL,
    date DATE NOT NULL,

    -- åŸºç¡€ç»Ÿè®¡
    total_questions INT DEFAULT 0,
    active_seconds INT DEFAULT 0,      -- æ´»è·ƒæ—¶é•¿ï¼ˆç§’ï¼‰
    unique_topics INT DEFAULT 0,       -- æ¢ç´¢çš„ä¸»é¢˜æ•°

    -- è¿½é—®ç»Ÿè®¡
    avg_chain_depth FLOAT,             -- å¹³å‡è¿½é—®æ·±åº¦
    max_chain_depth INT,               -- æœ€å¤§è¿½é—®æ·±åº¦
    follow_up_rate FLOAT,              -- è¿½é—®ç‡ï¼ˆè¿½é—®æ•°/æ€»é—®é¢˜æ•°ï¼‰

    -- é¢†åŸŸåˆ†å¸ƒï¼ˆJSONBæ ¼å¼ï¼Œçµæ´»å­˜å‚¨ï¼‰
    category_distribution JSONB DEFAULT '{}',
    -- ç¤ºä¾‹ï¼š{"ç§‘å­¦": 15, "æŠ€æœ¯": 5, "è‰ºæœ¯": 3}

    -- æ—¶é—´åˆ†å¸ƒï¼ˆæŒ‰å°æ—¶ç»Ÿè®¡ï¼‰
    hourly_activity JSONB DEFAULT '{}',
    -- ç¤ºä¾‹ï¼š{"08": 2, "09": 5, "10": 3}

    -- ä¼šè¯è´¨é‡æŒ‡æ ‡
    engagement_score FLOAT,            -- å‚ä¸åº¦ï¼ˆ0-1ï¼‰
    curiosity_level FLOAT,             -- å¥½å¥‡å¿ƒæ°´å¹³ï¼ˆ0-1ï¼‰

    -- å…³è”æ€»ç»“
    summary_id UUID REFERENCES daily_summaries(id) ON DELETE SET NULL,

    -- å…ƒæ•°æ®
    created_at TIMESTAMP DEFAULT NOW(),

    -- çº¦æŸï¼šåŒä¸€å­©å­ä¸€å¤©åªæœ‰ä¸€æ¡è®°å½•
    UNIQUE(child_id, date)
);

-- ========== æ±‡æ€»è¡¨ç´¢å¼• ==========

-- 1. æ—¥æœŸæŸ¥è¯¢ï¼šè·å–å­©å­æŸå¤©çš„æ±‡æ€»
CREATE INDEX idx_daily_sessions_child_date
ON daily_sessions(child_id, date DESC);

-- 2. æ—¥æœŸèŒƒå›´æŸ¥è¯¢ï¼šæŸ¥è¯¢æ—¶é—´æ®µçš„æ±‡æ€»
CREATE INDEX idx_daily_sessions_date_range
ON daily_sessions(child_id, date DESC);

-- 3. è´¨é‡æŒ‡æ ‡æ’åºï¼šæŒ‰å‚ä¸åº¦æ’åº
CREATE INDEX idx_daily_sessions_engagement
ON daily_sessions(child_id, engagement_score DESC);

-- ========== è‡ªåŠ¨æ›´æ–°è§¦å‘å™¨ ==========

-- æ¯æ¬¡æ’å…¥/æ›´æ–°é—®é¢˜æ—¶ï¼Œè‡ªåŠ¨æ›´æ–°daily_sessions
CREATE OR REPLACE FUNCTION update_daily_session_stats()
RETURNS TRIGGER AS $$
DECLARE
    session_date DATE;
BEGIN
    session_date := DATE(NEW.timestamp);

    -- æ’å…¥æˆ–æ›´æ–°æ¯æ—¥æ±‡æ€»
    INSERT INTO daily_sessions (
        child_id, date, total_questions
    ) VALUES (
        NEW.child_id, session_date, 1
    )
    ON CONFLICT (child_id, date) DO UPDATE SET
        total_questions = daily_sessions.total_questions + 1,
        updated_at = NOW();

    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_daily_stats
AFTER INSERT ON questions
FOR EACH ROW
EXECUTE FUNCTION update_daily_session_stats();
```

#### 2.5 æ¯æ—¥æ€»ç»“è¡¨ï¼ˆdaily_summariesï¼‰

å­˜å‚¨AIç”Ÿæˆçš„æ¯æ—¥æ€»ç»“å†…å®¹ï¼ˆå­©å­ç‰ˆ + å®¶é•¿ç‰ˆï¼‰ã€‚

```sql
-- ========== æ¯æ—¥æ€»ç»“è¡¨ ==========
CREATE TABLE daily_summaries (
    -- ä¸»é”®
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    child_id VARCHAR(50) NOT NULL,
    date DATE NOT NULL,

    -- æ€»ç»“ç±»å‹
    summary_type VARCHAR(20) NOT NULL,  -- 'child' æˆ– 'parent'

    -- æ€»ç»“å†…å®¹ï¼ˆJSONBæ ¼å¼ï¼Œçµæ´»å­˜å‚¨ç»“æ„åŒ–æ•°æ®ï¼‰
    summary_data JSONB NOT NULL,
    -- ç¤ºä¾‹ï¼š
    -- {
    --   "title": "ä»Šå¤©çš„å°ç§‘å­¦å®¶",
    --   "emoji_summary": "ğŸ¦•ğŸ”­âœ¨",
    --   "adventure_story": {...},
    --   "achievement_badges": [...],
    --   "growth_insights": [...]
    -- }

    -- ç”Ÿæˆä¿¡æ¯
    generation_time TIMESTAMP DEFAULT NOW(),
    model_version VARCHAR(50),          -- ä½¿ç”¨çš„æ¨¡å‹ç‰ˆæœ¬
    generation_params JSONB,             -- ç”Ÿæˆå‚æ•°ï¼ˆtemperatureç­‰ï¼‰

    -- è´¨é‡è¯„ä¼°
    quality_score FLOAT,                 -- æ€»ç»“è´¨é‡è¯„åˆ†ï¼ˆ0-1ï¼‰

    -- å…ƒæ•°æ®
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),

    -- çº¦æŸ
    CONSTRAINT valid_summary_type CHECK (summary_type IN ('child', 'parent')),
    UNIQUE(child_id, date, summary_type)
);

-- ========== æ€»ç»“è¡¨ç´¢å¼• ==========

-- 1. æŸ¥è¯¢å­©å­çš„æ€»ç»“
CREATE INDEX idx_daily_summaries_child_date
ON daily_summaries(child_id, date DESC, summary_type);

-- 2. æŒ‰ç±»å‹æŸ¥è¯¢
CREATE INDEX idx_daily_summaries_type
ON daily_summaries(summary_type, date DESC);

-- 3. è´¨é‡è¯„åˆ†æ’åº
CREATE INDEX idx_daily_summaries_quality
ON daily_summaries(child_id, quality_score DESC);

-- ========== è‡ªåŠ¨è§¦å‘å™¨ ==========

CREATE TRIGGER update_summaries_updated_at
BEFORE UPDATE ON daily_summaries
FOR EACH ROW
EXECUTE FUNCTION update_updated_at_column();
```

---

### ä¸‰ã€æ•°æ®éšç§ç­–ç•¥

éµå¾ª"æœ¬åœ°ä¼˜å…ˆ + åŒ¿ååŒ–ä¸Šä¼  + å®¶é•¿æ§åˆ¶"çš„éšç§ä¿æŠ¤åŸåˆ™ã€‚

#### 3.1 æœ¬åœ°å­˜å‚¨ç­–ç•¥ï¼ˆESP32ç«¯NVSï¼‰

ä½¿ç”¨ESP32çš„NVSï¼ˆNon-Volatile Storageï¼‰å®ç°æœ¬åœ°ç¼“å­˜ï¼Œç¡®ä¿ç½‘ç»œæ–­å¼€æ—¶æ•°æ®ä¸ä¸¢å¤±ã€‚

**NVSå‘½åç©ºé—´**ï¼š`thinking_partner`

**NVSå­˜å‚¨ç»“æ„**ï¼š

```cpp
// ========== NVSå­˜å‚¨ç»“æ„å®šä¹‰ ==========
namespace ThinkingPartner {

// æœ¬åœ°é—®é¢˜ç¼“å­˜ï¼ˆæœ€å¤§50æ¡ï¼‰
struct LocalQuestionCache {
    char question_id[37];          // UUIDå­—ç¬¦ä¸²
    char question_text[501];       // é—®é¢˜åŸæ–‡ï¼ˆæœ€å¤š500å­—ï¼‰
    time_t timestamp;              // Unixæ—¶é—´æˆ³

    // ä¼šè¯ä¸Šä¸‹æ–‡
    char session_id[37];           // ä¼šè¯UUID
    bool is_follow_up;             // æ˜¯å¦è¿½é—®
    int chain_depth;               // è¿½é—®æ·±åº¦

    // è‡ªåŠ¨åˆ†æï¼ˆæœ€å°ç‰ˆæœ¬ï¼‰
    char question_type[10];        // é—®é¢˜ç±»å‹
    char main_category[50];        // ä¸»åˆ†ç±»
    char keywords[5][50];          // 5ä¸ªå…³é”®è¯
    bool uploaded;                 // æ˜¯å¦å·²ä¸Šä¼ 
    time_t upload_time;            // ä¸Šä¼ æ—¶é—´ï¼ˆ0è¡¨ç¤ºæœªä¸Šä¼ ï¼‰
} __attribute__((packed));

// å­©å­åŒ¿åIDï¼ˆå®¶é•¿æˆæƒåç”Ÿæˆï¼‰
struct ChildIdentity {
    char anonymous_id[21];         // åŒ¿åIDï¼ˆchild_ + 16ä½hexï¼‰
    char device_id[20];            // è®¾å¤‡å”¯ä¸€ID
    bool parent_consent;           // å®¶é•¿æˆæƒæ ‡å¿—
    time_t consent_time;           // æˆæƒæ—¶é—´
} __attribute__((packed));

// æ•°æ®ç»Ÿè®¡
struct LocalStats {
    int total_questions;           // æœ¬åœ°æ€»é—®é¢˜æ•°
    int uploaded_count;            // å·²ä¸Šä¼ æ•°
    int pending_count;             // å¾…ä¸Šä¼ æ•°
    time_t last_upload;            // æœ€åä¸Šä¼ æ—¶é—´
} __attribute__((packed));

} // namespace ThinkingPartner
```

**NVSé”®å€¼è®¾è®¡**ï¼š

| NVSé”® | æ•°æ®ç±»å‹ | è¯´æ˜ |
|-------|---------|------|
| `child_identity` | blob | å­©å­èº«ä»½ä¿¡æ¯ï¼ˆChildIdentityç»“æ„ï¼‰ |
| `question_0` ~ `question_49` | blob | 50æ¡é—®é¢˜ç¼“å­˜ï¼ˆLocalQuestionCacheç»“æ„ï¼‰ |
| `stats` | blob | æœ¬åœ°ç»Ÿè®¡æ•°æ®ï¼ˆLocalStatsç»“æ„ï¼‰ |
| `last_session_id` | string | æœ€åä¸€æ¬¡ä¼šè¯ID |

**NVSæ“ä½œç¤ºä¾‹**ï¼š

```cpp
// åˆå§‹åŒ–NVS
nvs_handle_t nvs_handle;
esp_err_t err = nvs_open("thinking_partner", NVS_READWRITE, &nvs_handle);

// ä¿å­˜é—®é¢˜åˆ°æœ¬åœ°NVS
LocalQuestionCache question = {};
strncpy(question.question_id, "550e8400-...", 36);
strncpy(question.question_text, "ä¸ºä»€ä¹ˆå¤©ç©ºæ˜¯è“è‰²çš„ï¼Ÿ", 500);
question.timestamp = time(NULL);
question.uploaded = false;

nvs_set_blob(nvs_handle, "question_0", &question, sizeof(question));
nvs_commit(nvs_handle);

// è¯»å–å­©å­åŒ¿åID
ChildIdentity identity = {};
size_t required_size = sizeof(identity);
nvs_get_blob(nvs_handle, "child_identity", &identity, &required_size);

if (identity.parent_consent) {
    // å·²æˆæƒï¼Œå¯ä»¥ä¸Šä¼ æ•°æ®
    UploadQuestionToServer(question, identity.anonymous_id);
}

nvs_close(nvs_handle);
```

#### 3.2 åŒ¿ååŒ–ç­–ç•¥

**1. å­©å­IDåŒ¿ååŒ–**

ä½¿ç”¨HMAC-SHA256ç®—æ³•ç”Ÿæˆä¸å¯é€†çš„åŒ¿åIDï¼š

```python
import hashlib
import hmac

def hash_child_id(original_id: str) -> str:
    """
    å°†åŸå§‹å­©å­IDè½¬æ¢ä¸ºåŒ¿åID

    Args:
        original_id: åŸå§‹IDï¼ˆå¯ä»¥æ˜¯è®¾å¤‡IDæˆ–å®¶é•¿è®¾ç½®çš„IDï¼‰

    Returns:
        åŒ¿åIDï¼ˆæ ¼å¼ï¼šchild_å‰ç¼€ + 16ä½åå…­è¿›åˆ¶ï¼‰
    """
    secret_key = b"thinking_partner_secret_key_2025"  # å›ºå®šå¯†é’¥

    # ä½¿ç”¨HMAC-SHA256ç”Ÿæˆå“ˆå¸Œ
    hash_value = hmac.new(
        secret_key,
        original_id.encode(),
        hashlib.sha256
    ).digest()

    # å–å‰16ä¸ªå­—ç¬¦çš„åå…­è¿›åˆ¶è¡¨ç¤º
    anonymous_id = f"child_{hash_value[:8].hex()}"

    return anonymous_id

# ç¤ºä¾‹
original = "ESP32_001234_device_id"
anonymous = hash_child_id(original)
# è¾“å‡ºï¼šchild_a3f7c2e1b4d6f8a9
```

**2. éŸ³é¢‘æ–‡ä»¶å¤„ç†**

- **é»˜è®¤ä¸ä¸Šä¼ éŸ³é¢‘**ï¼šåªä¸Šä¼ æ–‡å­—è½¬å½•å†…å®¹
- **å¯é€‰ä¸Šä¼ **ï¼šå®¶é•¿åœ¨è®¾ç½®ä¸­å¼€å¯"ä¸Šä¼ è¯­éŸ³"åæ‰ä¸Šä¼ 
- **è‡ªåŠ¨è¿‡æœŸ**ï¼šæœ¬åœ°çš„åŸå§‹OpuséŸ³é¢‘æ–‡ä»¶30å¤©åè‡ªåŠ¨åˆ é™¤

```cpp
// æ£€æŸ¥æ˜¯å¦ä¸Šä¼ éŸ³é¢‘
bool ShouldUploadAudio() {
    nvs_handle_t nvs_handle;
    nvs_open("thinking_partner", NVS_READONLY, &nvs_handle);

    bool upload_audio = false;
    nvs_get_bool(nvs_handle, "upload_audio_enabled", &upload_audio);

    nvs_close(nvs_handle);
    return upload_audio;
}

// ä¸Šä¼ é—®é¢˜ï¼ˆå¸¦æ¡ä»¶åˆ¤æ–­ï¼‰
void UploadQuestion(const LocalQuestionCache& question, const char* anonymous_id) {
    // 1. å§‹ç»ˆä¸Šä¼ æ–‡å­—
    UploadQuestionText(question.question_text, anonymous_id);

    // 2. æ¡ä»¶ä¸Šä¼ éŸ³é¢‘
    if (ShouldUploadAudio()) {
        UploadAudioFile(question.audio_url, anonymous_id);
    }
}
```

**3. æ—¶é—´æˆ³æ¨¡ç³ŠåŒ–**

ä¸Šä¼ æ—¶å°†ç²¾ç¡®æ—¶é—´æˆ³æ¨¡ç³ŠåŒ–åˆ°"åˆ†é’Ÿ"çº§åˆ«ï¼Œå‡å°‘æ—¶é—´éšç§é£é™©ï¼š

```python
def blur_timestamp(timestamp: int) -> int:
    """
    å°†æ—¶é—´æˆ³æ¨¡ç³ŠåŒ–åˆ°åˆ†é’Ÿçº§åˆ«

    Args:
        timestamp: Unixæ—¶é—´æˆ³ï¼ˆç§’çº§ç²¾åº¦ï¼‰

    Returns:
        æ¨¡ç³ŠåŒ–åçš„æ—¶é—´æˆ³ï¼ˆå»æ‰ç§’æ•°ï¼‰
    """
    # 1. è½¬æ¢ä¸ºdatetime
    dt = datetime.fromtimestamp(timestamp)

    # 2. å»æ‰ç§’å’Œå¾®ç§’
    blurred_dt = dt.replace(second=0, microsecond=0)

    # 3. è½¬å›æ—¶é—´æˆ³
    return int(blurred_dt.timestamp())
```

#### 3.3 ä¸Šä¼ æœºåˆ¶è®¾è®¡

**1. ä¸Šä¼ è§¦å‘æ¡ä»¶**ï¼š

- âœ… WiFiè¿æ¥å»ºç«‹
- âœ… å®¶é•¿å·²æˆæƒï¼ˆparent_consent = trueï¼‰
- âœ… æœ‰å¾…ä¸Šä¼ æ•°æ®ï¼ˆuploaded = falseï¼‰

**2. ä¸Šä¼ é˜Ÿåˆ—ç®¡ç†**ï¼š

```cpp
class UploadQueueManager {
public:
    // æ·»åŠ åˆ°ä¸Šä¼ é˜Ÿåˆ—
    void AddToQueue(const LocalQuestionCache& question) {
        // 1. åŒ¿ååŒ–å¤„ç†
        std::string anonymous_id = GetAnonymousChildId();

        // 2. å‡†å¤‡ä¸Šä¼ æ•°æ®
        nlohmann::json upload_data = {
            {"question_id", question.question_id},
            {"child_id", anonymous_id},        // åŒ¿åID
            {"question_text", question.question_text},
            {"timestamp", blur_timestamp(question.timestamp)},
            {"is_follow_up", question.is_follow_up},
            {"chain_depth", question.chain_depth},
            {"keywords", ExtractKeywords(question.keywords)}
        };

        // 3. åŠ å…¥é˜Ÿåˆ—
        upload_queue_.push_back(upload_data);
    }

    // æ‰¹é‡ä¸Šä¼ ï¼ˆæ¯æ¬¡æœ€å¤š10æ¡ï¼‰
    void UploadBatch() {
        if (!IsWiFiConnected() || !IsParentConsented()) {
            return;
        }

        int batch_size = std::min((int)upload_queue_.size(), 10);
        auto batch_begin = upload_queue_.begin();
        auto batch_end = upload_queue_.begin() + batch_size;

        // å‘é€HTTP POSTè¯·æ±‚
        httpClient_.Post("/api/v1/questions/batch", {
            {"questions", std::vector<nlohmann::json>(batch_begin, batch_end)}
        });

        // ä¸Šä¼ æˆåŠŸåï¼Œä»é˜Ÿåˆ—ç§»é™¤å¹¶æ›´æ–°NVS
        upload_queue_.erase(batch_begin, batch_end);
        MarkAsUploaded(batch_begin, batch_end);
    }

private:
    std::deque<nlohmann::json> upload_queue_;

    // ä»NVSè·å–åŒ¿åID
    std::string GetAnonymousChildId() {
        nvs_handle_t nvs_handle;
        nvs_open("thinking_partner", NVS_READONLY, &nvs_handle);

        ChildIdentity identity = {};
        size_t size = sizeof(identity);
        nvs_get_blob(nvs_handle, "child_identity", &identity, &size);

        nvs_close(nvs_handle);
        return std::string(identity.anonymous_id);
    }
};
```

**3. ä¸Šä¼ é‡è¯•ç­–ç•¥**ï¼š

- æŒ‡æ•°é€€é¿é‡è¯•ï¼š1s â†’ 2s â†’ 4s â†’ 8s â†’ 16sï¼ˆæœ€å¤§ï¼‰
- æœ€å¤šé‡è¯•3æ¬¡
- 3æ¬¡å¤±è´¥åæ ‡è®°ä¸º"ä¸Šä¼ å¤±è´¥"ï¼Œä¿ç•™åœ¨NVSä¸­

#### 3.4 å®¶é•¿æˆæƒæµç¨‹

**1. é¦–æ¬¡ä½¿ç”¨æˆæƒ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ESP32è®¾å¤‡ä¸Šæ˜¾ç¤ºæˆæƒæç¤º                 â”‚
â”‚                                         â”‚
â”‚  ã€æ€è€ƒä¼™ä¼´ã€‘åŠŸèƒ½éœ€è¦ä¸Šä¼ æ•°æ®            â”‚
â”‚                                         â”‚
â”‚  â€¢ åªä¸Šä¼ é—®é¢˜æ–‡å­—ï¼ˆä¸å«å£°éŸ³ï¼‰            â”‚
â”‚  â€¢ èº«ä»½å·²åŒ¿ååŒ–å¤„ç†                      â”‚
â”‚  â€¢ å¯éšæ—¶åœæ­¢æˆ–åˆ é™¤å†å²                  â”‚
â”‚                                         â”‚
â”‚  [å®¶é•¿æˆæƒ]  [äº†è§£æ›´å¤š]  [æš‚æ—¶è·³è¿‡]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**2. æˆæƒæ•°æ®å­˜å‚¨**ï¼š

```cpp
// å®¶é•¿æˆæƒåçš„NVSå­˜å‚¨
void SaveParentConsent(bool consent) {
    nvs_handle_t nvs_handle;
    nvs_open("thinking_partner", NVS_READWRITE, &nvs_handle);

    ChildIdentity identity = {};
    if (consent) {
        // ç”ŸæˆåŒ¿åID
        std::string device_id = GetDeviceUniqueId();
        std::string anonymous_id = hash_child_id(device_id);

        strncpy(identity.anonymous_id, anonymous_id.c_str(), 20);
        strncpy(identity.device_id, device_id.c_str(), 20);
        identity.parent_consent = true;
        identity.consent_time = time(NULL);
    } else {
        // æœªæˆæƒ
        identity.parent_consent = false;
    }

    nvs_set_blob(nvs_handle, "child_identity", &identity, sizeof(identity));
    nvs_commit(nvs_handle);
    nvs_close(nvs_handle);
}
```

**3. æ’¤é”€æˆæƒ**ï¼š

å®¶é•¿å¯éšæ—¶æ’¤é”€æˆæƒï¼š
- æ’¤é”€ååœæ­¢ä¸Šä¼ æ–°æ•°æ®
- å·²ä¸Šä¼ å†å²æ•°æ®å¯ç”³è¯·åˆ é™¤ï¼ˆå‘é€åˆ é™¤è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼‰
- æœ¬åœ°æ•°æ®ä¿ç•™

#### 3.5 æ•°æ®ä¿ç•™ç­–ç•¥

| æ•°æ®ç±»å‹ | æœ¬åœ°ä¿ç•™æœŸ | æœåŠ¡ç«¯ä¿ç•™æœŸ | åˆ é™¤æ–¹å¼ |
|---------|-----------|-------------|---------|
| é—®é¢˜æ–‡å­— | æ°¸ä¹… | æ°¸ä¹… | å®¶é•¿æ‰‹åŠ¨åˆ é™¤ |
| åŸå§‹éŸ³é¢‘ | 30å¤© | ä¸ä¸Šä¼ ï¼ˆé»˜è®¤ï¼‰ | è‡ªåŠ¨åˆ é™¤ |
| ä¸Šä¼ çš„éŸ³é¢‘ | ä¸ä¸Šä¼  | 90å¤©ï¼ˆå¯é€‰å¼€å¯ï¼‰ | è‡ªåŠ¨åˆ é™¤ |
| æ¯æ—¥æ€»ç»“ | æ°¸ä¹… | æ°¸ä¹… | å®¶é•¿æ‰‹åŠ¨åˆ é™¤ |
| çŸ¥è¯†å›¾è°± | æ°¸ä¹… | æ°¸ä¹… | å®¶é•¿æ‰‹åŠ¨åˆ é™¤ |

**è‡ªåŠ¨åˆ é™¤å®ç°**ï¼š

```cpp
// å®šæœŸæ¸…ç†è¿‡æœŸéŸ³é¢‘ï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹æ‰§è¡Œï¼‰
void CleanExpiredAudio() {
    time_t now = time(NULL);
    time_t expiry_time = now - (30 * 24 * 60 * 60);  // 30å¤©å‰

    // éå†NVSä¸­çš„é—®é¢˜
    for (int i = 0; i < 50; i++) {
        char key[16];
        snprintf(key, sizeof(key), "question_%d", i);

        LocalQuestionCache question = {};
        size_t size = sizeof(question);
        if (nvs_get_blob(nvs_handle, key, &question, &size) == ESP_OK) {
            // åˆ é™¤30å¤©å‰çš„éŸ³é¢‘æ–‡ä»¶
            if (question.timestamp < expiry_time) {
                DeleteAudioFile(question.audio_url);
                ESP_LOGI(TAG, "Deleted expired audio for question %s", question.question_id);
            }
        }
    }
}
```

#### 3.6 æ•°æ®å¯¼å‡ºåŠŸèƒ½

æ”¯æŒå®¶é•¿å¯¼å‡ºå­©å­çš„æ‰€æœ‰æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰ï¼š

```python
# æœåŠ¡ç«¯å¯¼å‡ºAPI
@app.get("/api/v1/children/{child_id}/export")
async def export_child_data(child_id: str, current_user: User):
    """å¯¼å‡ºå­©å­çš„æ‰€æœ‰æ•°æ®"""

    # 1. éªŒè¯å®¶é•¿æƒé™
    if not VerifyParentAccess(current_user, child_id):
        raise HTTPException(403, "æ— æƒè®¿é—®")

    # 2. æŸ¥è¯¢æ‰€æœ‰æ•°æ®
    questions = db.query(Question).filter_by(child_id=child_id).all()
    summaries = db.query(DailySummary).filter_by(child_id=child_id).all()
    knowledge_graph = BuildKnowledgeGraph(child_id)

    # 3. ç”ŸæˆJSON
    export_data = {
        "export_time": datetime.now().isoformat(),
        "child_id": child_id,
        "total_questions": len(questions),
        "questions": [q.to_dict() for q in questions],
        "daily_summaries": [s.to_dict() for s in summaries],
        "knowledge_graph": knowledge_graph
    }

    # 4. è¿”å›æ–‡ä»¶
    return Response(
        content=json.dumps(export_data, ensure_ascii=False, indent=2),
        media_type="application/json",
        headers={
            "Content-Disposition": f"attachment; filename={child_id}_data.json"
        }
    )
```

---

**æœ¬èŠ‚è®¾è®¡æ€»ç»“**ï¼š

âœ… **æœ€å°å­—æ®µé›†**ï¼šå®šä¹‰äº†æ”¯æ’‘æ¯æ—¥æ€»ç»“åˆ†æçš„æœ€å°å¿…éœ€å­—æ®µï¼ˆ11ä¸ªå¿…å¡«å­—æ®µï¼‰
âœ… **æ¸…æ™°è¡¨ç»“æ„**ï¼šåŒºåˆ†å¯¹è¯è®°å½•è¡¨ï¼ˆquestionsï¼‰å’ŒçŸ¥è¯†å›¾è°±è¡¨ï¼ˆknowledge_nodes/edgesï¼‰ï¼Œå…±5ä¸ªæ ¸å¿ƒè¡¨
âœ… **éšç§ä¿æŠ¤**ï¼šæœ¬åœ°NVSç¼“å­˜ + åŒ¿ååŒ–ä¸Šä¼  + å®¶é•¿æˆæƒ + è‡ªåŠ¨è¿‡æœŸ
âœ… **æ¸è¿›å¼å®ç°**ï¼šå­—æ®µæ ‡æ³¨äº†MVPå„é˜¶æ®µçš„å®ç°ä¼˜å…ˆçº§

---

## 2.2 å­˜å‚¨å±‚è®¾è®¡

### æ•°æ®åº“é€‰æ‹©

| å±‚çº§ | æ•°æ®åº“ | ç”¨é€” | ç†ç”± |
|------|--------|------|------|
| ä¸»æ•°æ®åº“ | PostgreSQL 14+ | å­˜å‚¨é—®é¢˜ã€ä¼šè¯ã€æ€»ç»“ | å…³ç³»å‹ã€äº‹åŠ¡æ”¯æŒã€å…¨æ–‡æœç´¢ |
| ç¼“å­˜å±‚ | Redis 7+ | å®æ—¶ç»Ÿè®¡ã€çƒ­ç‚¹æ•°æ® | é«˜æ€§èƒ½ã€è¿‡æœŸç­–ç•¥ |
| å›¾æ•°æ®åº“ | Neo4j 5+ | çŸ¥è¯†å›¾è°± | åŸç”Ÿå›¾æŸ¥è¯¢ã€å¯è§†åŒ–å‹å¥½ |

### è¡¨ç»“æ„è®¾è®¡

```sql
-- ========== é—®é¢˜è¡¨ ==========
CREATE TABLE questions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    child_id VARCHAR(50) NOT NULL,
    device_id VARCHAR(50),

    -- é—®é¢˜å†…å®¹
    question_text TEXT NOT NULL,
    audio_url VARCHAR(512),
    timestamp TIMESTAMP NOT NULL DEFAULT NOW(),

    -- ä¸Šä¸‹æ–‡
    session_id UUID,
    is_follow_up BOOLEAN DEFAULT false,
    chain_depth INT DEFAULT 1,
    previous_topic VARCHAR(100),

    -- è‡ªåŠ¨åˆ†æ
    question_type VARCHAR(10),
    main_category VARCHAR(50),
    sub_categories TEXT[],
    keywords TEXT[],
    cognitive_level INT,
    complexity_score FLOAT,
    thinking_patterns TEXT[],
    interest_score FLOAT,

    -- AIå›å¤
    response_text TEXT,
    response_audio_url VARCHAR(512),
    follow_up_suggestions TEXT[],

    -- å…ƒæ•°æ®
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ç´¢å¼•
CREATE INDEX idx_questions_child_time ON questions(child_id, timestamp DESC);
CREATE INDEX idx_questions_category ON questions(main_category);
CREATE INDEX idx_questions_type ON questions(question_type);
CREATE INDEX idx_questions_keywords ON questions USING GIN(keywords);

-- ========== æ¯æ—¥ä¼šè¯è¡¨ ==========
CREATE TABLE daily_sessions (
    session_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    child_id VARCHAR(50) NOT NULL,
    date DATE NOT NULL,

    -- ç»Ÿè®¡ä¿¡æ¯
    total_questions INT DEFAULT 0,
    active_seconds INT DEFAULT 0,
    unique_topics INT DEFAULT 0,

    -- è¿½é—®ç»Ÿè®¡
    avg_chain_depth FLOAT,
    max_chain_depth INT,

    -- é¢†åŸŸåˆ†å¸ƒ
    category_distribution JSONB,

    -- æ—¶é—´åˆ†å¸ƒ
    hourly_activity JSONB,

    -- ä¼šè¯è´¨é‡
    engagement_score FLOAT,
    curiosity_level FLOAT,

    -- ç”Ÿæˆçš„æ€»ç»“
    summary_id UUID,

    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(child_id, date)
);

CREATE INDEX idx_daily_sessions_child_date ON daily_sessions(child_id, date DESC);

-- ========== çŸ¥è¯†èŠ‚ç‚¹è¡¨ ==========
CREATE TABLE knowledge_nodes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    child_id VARCHAR(50) NOT NULL,

    label VARCHAR(100) NOT NULL,
    category VARCHAR(50),
    aliases TEXT[],

    visit_count INT DEFAULT 1,
    avg_depth FLOAT,
    last_visit TIMESTAMP,

    mastery_level FLOAT DEFAULT 0.3,

    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(child_id, label)
);

CREATE INDEX idx_knowledge_nodes_child ON knowledge_nodes(child_id, visit_count DESC);

-- ========== çŸ¥è¯†å…³ç³»è¡¨ ==========
CREATE TABLE knowledge_edges (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    child_id VARCHAR(50) NOT NULL,

    source_node_id UUID REFERENCES knowledge_nodes(id),
    target_node_id UUID REFERENCES knowledge_nodes(id),
    relation_type VARCHAR(50),
    strength FLOAT DEFAULT 1.0,

    source_question_id UUID REFERENCES questions(id),

    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_knowledge_edges_child ON knowledge_edges(child_id, strength DESC);

-- ========== æ¯æ—¥æ€»ç»“è¡¨ ==========
CREATE TABLE daily_summaries (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    child_id VARCHAR(50) NOT NULL,
    date DATE NOT NULL,

    summary_type VARCHAR(20),  -- child/parent
    summary_data JSONB NOT NULL,

    generation_time TIMESTAMP DEFAULT NOW(),
    model_version VARCHAR(50),

    UNIQUE(child_id, date, summary_type)
);

CREATE INDEX idx_daily_summaries_child_date ON daily_summaries(child_id, date DESC);
```

### ç´¢å¼•è®¾è®¡

1. **å¤åˆç´¢å¼•**
   ```sql
   -- æœ€å¸¸ç”¨æŸ¥è¯¢ï¼šè·å–å­©å­æŸå¤©çš„é—®é¢˜
   CREATE INDEX idx_questions_child_date
   ON questions(child_id, date(timestamp) DESC, timestamp DESC);
   ```

2. **GINç´¢å¼•**ï¼ˆå…¨æ–‡æœç´¢ï¼‰
   ```sql
   -- å…³é”®è¯æœç´¢
   CREATE INDEX idx_questions_keywords_gin
   ON questions USING GIN(keywords);
   ```

3. **éƒ¨åˆ†ç´¢å¼•**ï¼ˆä¼˜åŒ–æ€§èƒ½ï¼‰
   ```sql
   -- åªç´¢å¼•è¿‘30å¤©çš„æ•°æ®
   CREATE INDEX idx_questions_recent
   ON questions(child_id, timestamp DESC)
   WHERE timestamp > NOW() - INTERVAL '30 days';
   ```

---

## 2.3 åˆ†æå±‚è®¾è®¡

### å…´è¶£é¢†åŸŸæ ‡ç­¾ç³»ç»Ÿ

```python
# é¢†åŸŸåˆ†ç±»ä½“ç³»
INTEREST_CATEGORIES = {
    "ç§‘å­¦": {
        "ç‰©ç†": ["åŠ›å­¦", "å…‰å­¦", "ç”µå­¦", "ç£å­¦", "èƒ½é‡"],
        "åŒ–å­¦": ["é…¸ç¢±", "ç‡ƒçƒ§", "æº¶è§£", "å˜åŒ–"],
        "ç”Ÿç‰©": ["åŠ¨ç‰©", "æ¤ç‰©", "äººä½“", "å¾®ç”Ÿç‰©"],
        "å¤©æ–‡": ["è¡Œæ˜Ÿ", "æ’æ˜Ÿ", "å®‡å®™", "é»‘æ´"],
        "åœ°ç†": ["åœ°å½¢", "æ°”å€™", "å›½å®¶", "æµ·æ´‹"],
        "å¤ç”Ÿç‰©": ["æé¾™", "åŒ–çŸ³", "è¿›åŒ–"]
    },
    "æŠ€æœ¯": {
        "æœºå™¨äºº": ["ç¼–ç¨‹", "ä¼ æ„Ÿå™¨", "AI"],
        "ç”µè„‘": ["ç¡¬ä»¶", "è½¯ä»¶", "ç½‘ç»œ"],
        "äº¤é€šå·¥å…·": ["æ±½è½¦", "é£æœº", "ç«ç®­"]
    },
    "è‰ºæœ¯": {
        "ç»˜ç”»": ["æ°´å½©", "æ²¹ç”»", "ç´ æ"],
        "éŸ³ä¹": ["ä¹å™¨", "æ­Œæ›²", "èŠ‚å¥"],
        "æ‰‹å·¥": ["æŠ˜çº¸", "ç²˜åœŸ", "æ‹¼è´´"]
    },
    "æ–‡å­¦": {
        "æ•…äº‹": ["ç«¥è¯", "å¯“è¨€", "å†’é™©"],
        "è¯—æ­Œ": ["å”è¯—", "å„¿æ­Œ", "ç°ä»£è¯—"],
        "æˆè¯­": ["å¯“è¨€", "å†å²", "æ™ºæ…§"]
    },
    "ç¤¾ä¼š": {
        "èŒä¸š": ["åŒ»ç”Ÿ", "è€å¸ˆ", "è­¦å¯Ÿ"],
        "æ–‡åŒ–": ["èŠ‚æ—¥", "ä¹ ä¿—", "ä¼ ç»Ÿ"],
        "äººé™…": ["å‹è°Š", "åˆä½œ", "åˆ†äº«"]
    },
    "æƒ…æ„Ÿ": {
        "æƒ…ç»ª": ["å¼€å¿ƒ", "éš¾è¿‡", "ç”Ÿæ°”"],
        "å“æ ¼": ["å‹‡æ•¢", "å–„è‰¯", "è¯šå®"],
        "å®¶åº­": ["çˆ¸çˆ¸", "å¦ˆå¦ˆ", "å…„å¼Ÿå§å¦¹"]
    },
    "ç”Ÿæ´»": {
        "é¥®é£Ÿ": ["é£Ÿç‰©", "è¥å…»", "å¥åº·"],
        "ä¹ æƒ¯": ["ç¡çœ ", "è¿åŠ¨", "æ•´ç†"],
        "å­¦æ ¡": ["å­¦ä¹ ", "è€ƒè¯•", "åŒå­¦"]
    }
}
```

### æé—®ç±»å‹åˆ†ç±»é€»è¾‘

```python
QUESTION_TYPE_PATTERNS = {
    "what": {
        "patterns": ["ä»€ä¹ˆæ˜¯", "æ˜¯ä»€ä¹ˆ", "å“ªä¸ª", "å“ªäº›", "ä»€ä¹ˆæ ·çš„"],
        "cognitive_focus": "å®šä¹‰ã€è¯†åˆ«",
        "typical_depth": 1
    },
    "why": {
        "patterns": ["ä¸ºä»€ä¹ˆ", "ä¸ºå•¥", "æ€ä¹ˆå°±", "åŸå› æ˜¯"],
        "cognitive_focus": "å› æœå…³ç³»",
        "typical_depth": 3
    },
    "how": {
        "patterns": ["æ€ä¹ˆåš", "æ€ä¹ˆ", "å¦‚ä½•", "æ–¹æ³•"],
        "cognitive_focus": "è¿‡ç¨‹ã€æ–¹æ³•",
        "typical_depth": 2
    },
    "who": {
        "patterns": ["è°", "å“ªä¸ªäºº", "ä»€ä¹ˆäºº"],
        "cognitive_focus": "äººç‰©è¯†åˆ«",
        "typical_depth": 1
    },
    "where": {
        "patterns": ["åœ¨å“ªé‡Œ", "åœ¨å“ª", "å“ªé‡Œ", "ä»€ä¹ˆåœ°æ–¹"],
        "cognitive_focus": "ç©ºé—´ä½ç½®",
        "typical_depth": 1
    },
    "when": {
        "patterns": ["ä»€ä¹ˆæ—¶å€™", "å‡ æ—¶", "ä½•æ—¶", "ä»€ä¹ˆæ—¶é—´"],
        "cognitive_focus": "æ—¶é—´é¡ºåº",
        "typical_depth": 1
    },
    "compare": {
        "patterns": ["å“ªä¸ªå¥½", "åŒºåˆ«", "ä¸åŒ", "ä¸€æ ·å—", "å¯¹æ¯”", "æ¯”è¾ƒ"],
        "cognitive_focus": "æ¯”è¾ƒåˆ†æ",
        "typical_depth": 4
    }
}
```

### çŸ¥è¯†å›¾è°±æ„å»ºæ–¹æ¡ˆ

```python
class KnowledgeGraphBuilder:
    """çŸ¥è¯†å›¾è°±æ„å»ºå™¨"""

    def build_from_questions(self, questions: list) -> dict:
        """ä»é—®ç­”åˆ—è¡¨æ„å»ºçŸ¥è¯†å›¾è°±"""
        graph = {"nodes": [], "edges": []}

        for q in questions:
            # 1. å®ä½“è¯†åˆ«ï¼ˆå…³é”®è¯ä½œä¸ºèŠ‚ç‚¹ï¼‰
            entities = self._extract_entities(q['question_text'])

            # 2. åˆ›å»ºæˆ–æ›´æ–°èŠ‚ç‚¹
            for entity in entities:
                node = self._get_or_create_node(
                    child_id=q['child_id'],
                    label=entity,
                    category=q['main_category']
                )
                graph["nodes"].append(node)

            # 3. å…³ç³»æŠ½å–ï¼ˆé—®é¢˜ä¸­çš„å®ä½“å…³ç³»ï¼‰
            if len(entities) >= 2:
                edges = self._extract_relations(
                    q['question_text'],
                    entities,
                    q['question_type']
                )
                graph["edges"].extend(edges)

        return graph

    def _extract_entities(self, text: str) -> list:
        """æå–å®ä½“ï¼ˆå…³é”®è¯ï¼‰"""
        keywords = []

        # åŸºäºè¯å…¸åŒ¹é…
        for category, sub_cats in INTEREST_CATEGORIES.items():
            for sub_cat, terms in sub_cats.items():
                for term in terms:
                    if term in text:
                        keywords.append(term)

        return list(set(keywords))[:5]  # æœ€å¤š5ä¸ª

    def _extract_relations(self, text: str, entities: list,
                          question_type: str) -> list:
        """æŠ½å–å®ä½“é—´å…³ç³»"""
        relations = []

        # åŸºäºé—®é¢˜ç±»å‹æ¨æ–­å…³ç³»
        relation_type_map = {
            "what": "åŒ…å«",
            "why": "å› æœ",
            "how": "æ–¹æ³•",
            "compare": "å¯¹æ¯”"
        }

        rel_type = relation_type_map.get(question_type, "ç›¸å…³")

        # åˆ›å»ºå®ä½“å¯¹
        for i in range(len(entities) - 1):
            relations.append({
                "source": entities[i],
                "target": entities[i + 1],
                "relation_type": rel_type,
                "strength": 0.5  # åˆå§‹å¼ºåº¦
            })

        return relations
```

### çŸ¥è¯†ç¼ºå£æ£€æµ‹ç®—æ³•

```python
class KnowledgeGapDetector:
    """çŸ¥è¯†ç¼ºå£æ£€æµ‹å™¨"""

    def detect_gaps(self, child_id: str, recent_questions: list) -> list:
        """æ£€æµ‹çŸ¥è¯†ç¼ºå£"""
        gaps = []

        # 1. æ·±åº¦è¿½é—®ç¼ºå£ï¼ˆè¿ç»­3æ¬¡ä»¥ä¸Šè¿½é—®ï¼‰
        deep_follow_ups = self._detect_deep_follow_ups(recent_questions)
        gaps.extend(deep_follow_ups)

        # 2. æ¦‚å¿µç¼ºå£ï¼ˆæåˆ°çš„æ¦‚å¿µä½†æœªæ·±å…¥ï¼‰
        concept_gaps = self._detect_concept_gaps(recent_questions)
        gaps.extend(concept_gaps)

        # 3. è·¨é¢†åŸŸç¼ºå£ï¼ˆä¸åŒé¢†åŸŸçš„æ½œåœ¨è”ç³»ï¼‰
        cross_domain_gaps = self._detect_cross_domain_gaps(recent_questions)
        gaps.extend(cross_domain_gaps)

        return gaps

    def _detect_deep_follow_ups(self, questions: list) -> list:
        """æ£€æµ‹æ·±åº¦è¿½é—®"""
        gaps = []

        # æŒ‰è¯é¢˜åˆ†ç»„
        topic_groups = defaultdict(list)
        for q in questions:
            if q.get('is_follow_up'):
                topic_groups[q['main_topic']].append(q)

        # æ£€æµ‹è¿½é—®æ·±åº¦
        for topic, qs in topic_groups.items():
            if len(qs) >= 3:
                max_depth = max(q.get('chain_depth', 1) for q in qs)
                if max_depth >= 3:
                    gaps.append({
                        "gap_type": "deep_confusion",
                        "topic": topic,
                        "severity": "high",
                        "suggestion": f"å­©å­åœ¨'{topic}'ä¸Šæœ‰æ·±åº¦å›°æƒ‘ï¼Œå¯ä»¥æä¾›æ›´ç³»ç»Ÿçš„è§£é‡Š",
                        "resource_type": "systematic_explanation"
                    })

        return gaps
```

---

## 2.4 æ€»ç»“ç”Ÿæˆå±‚è®¾è®¡

### å­©å­ç‰ˆPromptæ¨¡æ¿

```
ä½ æ˜¯ä¸€ä½äº²åˆ‡ã€å……æ»¡å¥½å¥‡å¿ƒçš„å„¿ç«¥å¯¼å¸ˆï¼Œåå«"å°æ¢"ã€‚ä½ æ“…é•¿ç”¨å­©å­çš„è¯­è¨€æ€»ç»“æ¢ç´¢æˆæœã€‚

## ä»Šæ—¥æ¢ç´¢æ•°æ®

### é—®é¢˜åˆ—è¡¨ï¼ˆæŒ‰æ—¶é—´ï¼‰
{questions_formatted}

### ç»Ÿè®¡ä¿¡æ¯
- æ€»é—®é¢˜æ•°ï¼š{total_questions}
- æ¢ç´¢æ—¶é•¿ï¼š{duration} åˆ†é’Ÿ
- å‘ç°çš„ä¸»é¢˜ï¼š{topics_list}
- è¿½é—®æ¬¡æ•°ï¼š{follow_up_count}

## æ ¸å¿ƒåŸåˆ™ï¼ˆä¸¥æ ¼éµå®ˆï¼‰

1. **ç”¨å­©å­çš„è¯­è¨€**
   âŒ "ä½ çš„è®¤çŸ¥èƒ½åŠ›æœ‰æ˜¾è‘—æå‡"
   âœ… "ä»Šå¤©ä½ çš„å°è„‘ç“œè½¬å¾—ç‰¹åˆ«å¿«ï¼"

2. **å…·ä½“è€Œéç¬¼ç»Ÿ**
   âŒ "ä½ å¾ˆæ£’"
   âœ… "ä½ é—®äº†5æ¬¡å…³äºæé¾™çš„é—®é¢˜ï¼Œéƒ½å¿«æˆæé¾™å°ä¸“å®¶äº†ï¼"

3. **çªå‡ºäº®ç‚¹**
   - æåˆ°å…·ä½“çš„æœ‰è¶£é—®é¢˜
   - å¼ºè°ƒæ€ç»´çš„è¿›æ­¥
   - è‚¯å®šå¥½å¥‡å¿ƒå’ŒåšæŒ

4. **ä¿æŠ¤å¥½å¥‡å¿ƒ**
   - ä¸è¯„åˆ¤é—®é¢˜çš„"ä»·å€¼"
   - é¼“åŠ±ç»§ç»­æ¢ç´¢
   - æ¯ä¸ªé—®é¢˜éƒ½æœ‰æ„ä¹‰

## è¾“å‡ºæ ¼å¼ï¼ˆä¸¥æ ¼JSONï¼‰

{
  "title": "ä»Šå¤©çš„å°ç§‘å­¦å®¶",
  "emoji_summary": "ğŸ¦•ğŸ”­âœ¨",
  "adventure_story": { ... },
  "achievement_badges": [ ... ]
}
```

### å®¶é•¿ç‰ˆPromptæ¨¡æ¿

```
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å„¿ç«¥å‘å±•å¿ƒç†å­¦å®¶ï¼Œåå«"åšå£«"ã€‚ä½ æ“…é•¿å‘å®¶é•¿æ±‡æŠ¥å­©å­çš„æˆé•¿æƒ…å†µã€‚

## ä»Šæ—¥è§‚å¯Ÿæ•°æ®

### é—®ç­”è®°å½•ï¼ˆè¯¦ç»†ï¼‰
{questions_analysis_formatted}

### è®¤çŸ¥å‘å±•æŒ‡æ ‡
- å¥½å¥‡å¿ƒæŒ‡æ•°ï¼š{curiosity_score}/1.0
- æ‰¹åˆ¤æ€§æ€ç»´ï¼š{critical_thinking_score}/1.0
- åˆ›é€ åŠ›ï¼š{creativity_score}/1.0

## æ ¸å¿ƒåŸåˆ™ï¼ˆä¸¥æ ¼éµå®ˆï¼‰

1. **åŸºäºè¯æ®**
   - æ¯ä¸ªç»“è®ºéƒ½æœ‰æ•°æ®æ”¯æ’‘
   - å¼•ç”¨å…·ä½“çš„é—®é¢˜ç¤ºä¾‹
   - é¿å…ä¸»è§‚è‡†æ–­

2. **å‘ç°é—ªå…‰ç‚¹**
   - è¯†åˆ«å­©å­çš„ä¼˜åŠ¿
   - è‚¯å®šè¿›æ­¥
   - ä¿æŠ¤ç‹¬ç‰¹æ€§

3. **æ¸©å’Œæé†’**
   - æŒ‡å‡ºå¯å‘å±•çš„æ–¹å‘
   - ä¸ä½¿ç”¨è´Ÿé¢æ ‡ç­¾
   - æä¾›å»ºè®¾æ€§å»ºè®®

4. **å¯æ“ä½œæ€§**
   - ç»™å‡ºå…·ä½“çš„æ´»åŠ¨å»ºè®®
   - æ¨èèµ„æºï¼ˆä¹¦ç±/è§†é¢‘/æ´»åŠ¨ï¼‰
   - æä¾›å¯¹è¯å¼•å¯¼
```

### è°ƒç”¨å‚æ•°é…ç½®

```python
# LLM è°ƒç”¨é…ç½®
LLM_CONFIG = {
    "model": "gpt-4-turbo-preview",

    # å­©å­ç‰ˆå‚æ•°
    "child_version": {
        "temperature": 0.8,      # è¾ƒé«˜ï¼Œå¢åŠ åˆ›é€ æ€§
        "max_tokens": 1500,
        "top_p": 0.9,
        "frequency_penalty": 0.3,
        "presence_penalty": 0.3
    },

    # å®¶é•¿ç‰ˆå‚æ•°
    "parent_version": {
        "temperature": 0.7,      # é€‚ä¸­ï¼Œå¹³è¡¡ä¸“ä¸šæ€§å’Œåˆ›é€ æ€§
        "max_tokens": 2000,
        "top_p": 0.9,
        "frequency_penalty": 0.2,
        "presence_penalty": 0.2
    }
}
```

---

## 2.5 å¯è§†åŒ–è®¾è®¡

### å­©å­ç«¯UIç»„ä»¶

```cpp
// ESP32 å±å¹•è®¾è®¡ï¼ˆ240x240ï¼‰

// é¡µé¢1ï¼šæ¦‚è§ˆé¡µ
void DrawOverviewPage(const SummaryData& summary) {
    // 1. Emojiäº‘ï¼ˆé¡¶éƒ¨ï¼‰
    lv_obj_t* emoji_container = lv_obj_create(lv_scr_act());
    // ... ç»˜åˆ¶emoji

    // 2. æ ‡é¢˜
    lv_obj_t* title_label = lv_label_create(lv_scr_act());
    lv_label_set_text(title_label, summary.title.c_str());

    // 3. ç»Ÿè®¡ä¿¡æ¯
    lv_obj_t* stats_label = lv_label_create(lv_scr_act());
    // ... æ˜¾ç¤ºé—®é¢˜æ•°ã€æ—¶é•¿
}
```

### å®¶é•¿ç«¯Dashboardè®¾è®¡

```vue
<!-- å®¶é•¿Webç«¯ï¼ˆVue 3 + EChartsï¼‰ -->
<template>
  <div class="daily-summary">
    <!-- è®¤çŸ¥å‘å±•é›·è¾¾å›¾ -->
    <el-card>
      <v-chart :option="radarOption" />
    </el-card>

    <!-- çŸ¥è¯†ç½‘ç»œå›¾ -->
    <el-card>
      <v-chart :option="graphOption" />
    </el-card>
  </div>
</template>
```

---

## ä¸‰ã€MVPå¼€å‘è·¯çº¿å›¾

### MVP 0.1ï¼ˆå½“å‰é˜¶æ®µï¼‰

**ç›®æ ‡**ï¼šåŸºç¡€å¯¹è¯è®°å½• + ç®€å•å…³é”®è¯ç»Ÿè®¡

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… ESP32ç«¯é—®é¢˜è®°å½•ï¼ˆè¯­éŸ³è½¬æ–‡å­—ï¼‰
- âœ… æœ¬åœ°ç¼“å­˜ï¼ˆNVSå­˜å‚¨ï¼Œæœ€å¤š50æ¡ï¼‰
- âœ… ç½‘ç»œæ¢å¤åè‡ªåŠ¨ä¸Šä¼ 
- âœ… ç®€å•ç»Ÿè®¡ï¼šé—®é¢˜æ•°ã€æ—¶é•¿ã€å…³é”®è¯é¢‘ç‡
- âœ… æ¯æ—¥æ–‡æœ¬æ€»ç»“ï¼šé—®é¢˜åˆ—è¡¨ + ç»Ÿè®¡æ•°å­—

**å¯ç®€åŒ–éƒ¨åˆ†**ï¼š
- âŒ æš‚ä¸åšè¯­ä¹‰åˆ†æï¼ˆé—®é¢˜ç±»å‹ã€é¢†åŸŸåˆ†ç±»ï¼‰
- âŒ æš‚ä¸åšçŸ¥è¯†å›¾è°±
- âŒ æš‚ä¸åšAIç”Ÿæˆæ€»ç»“
- âŒ å®¶é•¿Webç«¯æš‚ä¸åšï¼Œå…ˆç”¨JSONå¯¼å‡º

**éªŒæ”¶æ ‡å‡†**ï¼š
- èƒ½è®°å½•100+é—®é¢˜ä¸ä¸¢åŒ…
- ç»Ÿè®¡å‡†ç¡®ç‡>95%
- ç¦»çº¿åœºæ™¯æ­£å¸¸å·¥ä½œ

---

### MVP 0.5

**ç›®æ ‡**ï¼šå¢åŠ é¢†åŸŸæ ‡ç­¾ + æé—®ç±»å‹åˆ†ç±»

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… é—®é¢˜åˆ†ç±»å™¨ï¼ˆåŸºäºè§„åˆ™ï¼‰
  - 7å¤§é¢†åŸŸåˆ†ç±»ï¼ˆç§‘å­¦/æŠ€æœ¯/è‰ºæœ¯/æ–‡å­¦/ç¤¾ä¼š/æƒ…æ„Ÿ/ç”Ÿæ´»ï¼‰
  - 7ç§é—®é¢˜ç±»å‹ï¼ˆwhat/why/how/who/where/when/compareï¼‰
- âœ… è®¤çŸ¥å±‚æ¬¡è¯„ä¼°ï¼ˆ1-5çº§ï¼‰
- âœ… å…´è¶£çƒ­åº¦è®¡ç®—
- âœ… çŸ¥è¯†èŠ‚ç‚¹è®°å½•ï¼ˆå…³é”®è¯ä½œä¸ºèŠ‚ç‚¹ï¼‰
- âœ… æ¯æ—¥æ€»ç»“å¢åŠ ï¼šé¢†åŸŸåˆ†å¸ƒã€é—®é¢˜ç±»å‹åˆ†å¸ƒ

**å¯ç®€åŒ–éƒ¨åˆ†**ï¼š
- âŒ æš‚ä¸åšå…³ç³»æŠ½å–ï¼ˆçŸ¥è¯†å›¾è°±æš‚æ— è¿çº¿ï¼‰
- âŒ æš‚ä¸åšæ€ç»´æ¨¡å¼è¯†åˆ«
- âŒ AIæ€»ç»“æš‚ç”¨æ¨¡æ¿å¡«å……ï¼Œä¸ç”¨GPT

**éªŒæ”¶æ ‡å‡†**ï¼š
- åˆ†ç±»å‡†ç¡®ç‡>70%
- èƒ½è¯†åˆ«5å¤§é¢†åŸŸ
- è®¤çŸ¥å±‚æ¬¡è¯„ä¼°ä¸äººå·¥æ ‡æ³¨ç›¸å…³æ€§>0.6

---

### MVP 0.8

**ç›®æ ‡**ï¼šAIç”Ÿæˆæ€»ç»“ + çŸ¥è¯†å›¾è°±

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… é›†æˆGPT-4 API
  - å­©å­ç‰ˆæ€»ç»“ç”Ÿæˆ
  - å®¶é•¿ç‰ˆæ´å¯ŸæŠ¥å‘Š
- âœ… çŸ¥è¯†å›¾è°±æ„å»º
  - å®ä½“è¯†åˆ«ï¼ˆå…³é”®è¯ï¼‰
  - å…³ç³»æŠ½å–ï¼ˆåŸºäºé—®é¢˜ç±»å‹ï¼‰
  - Neo4jå­˜å‚¨
- âœ… çŸ¥è¯†å›¾è°±å¯è§†åŒ–ï¼ˆåŠ›å¯¼å‘å›¾ï¼‰
- âœ… ESP32å±å¹•æ˜¾ç¤ºä¼˜åŒ–

**å¯ç®€åŒ–éƒ¨åˆ†**ï¼š
- âŒ æš‚ä¸åšé•¿æœŸæˆé•¿è¿½è¸ªï¼ˆå‘¨åº¦/æœˆåº¦ï¼‰
- âŒ æš‚ä¸åšä¸ªæ€§åŒ–æ¨è
- âŒ å®¶é•¿ç«¯åªåšåŸºç¡€å±•ç¤ºï¼Œä¸åšäº¤äº’

**éªŒæ”¶æ ‡å‡†**ï¼š
- AIæ€»ç»“ç”Ÿæˆç‡>95%
- æ€»ç»“è´¨é‡ï¼ˆäººå·¥è¯„ä¼°ï¼‰>4/5
- çŸ¥è¯†å›¾è°±èƒ½ç”¨EChartsæ¸²æŸ“

---

### MVP 1.0

**ç›®æ ‡**ï¼šå®Œæ•´åŠŸèƒ½ + å®¶é•¿Webç«¯

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… å®Œæ•´çš„5å±‚æ¶æ„
- âœ… å®¶é•¿Webç«¯
  - æ¯æ—¥æŠ¥å‘ŠæŸ¥çœ‹
  - æˆé•¿è¶‹åŠ¿å›¾
  - çŸ¥è¯†å›¾è°±äº¤äº’
  - èµ„æºæ¨è
- âœ… é•¿æœŸæˆé•¿è¿½è¸ª
  - å‘¨åº¦/æœˆåº¦æŠ¥å‘Š
  - èƒ½åŠ›é›·è¾¾å›¾è¶‹åŠ¿
  - å…´è¶£æ¼”å˜åˆ†æ
- âœ… ä¸ªæ€§åŒ–æ¨è
  - åŸºäºå…´è¶£çš„èµ„æºæ¨è
  - å¯¹è¯å¼•å¯¼å»ºè®®
- âœ… æ•°æ®å¯¼å‡ºåŠŸèƒ½

**éªŒæ”¶æ ‡å‡†**ï¼š
- æ”¯æŒå¹¶å‘100ä¸ªå­©å­
- ç«¯åˆ°ç«¯å»¶è¿Ÿ<3ç§’
- ç”¨æˆ·æ»¡æ„åº¦>4/5

---

## å››ã€æ–‡ä»¶ç»“æ„çº¦å®š

```
eyes-project/
â”œâ”€â”€ main/                          # ESP32å›ºä»¶
â”‚   â”œâ”€â”€ thinking_partner/          # æ€è€ƒä¼™ä¼´åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ thinking_partner.h     # ä¸»å¤´æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ thinking_partner.cc    # å®ç°
â”‚   â”‚   â”œâ”€â”€ interaction.h          # äº¤äº’ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ interaction.cc
â”‚   â”‚   â”œâ”€â”€ display.h              # æ˜¾ç¤ºæ§åˆ¶
â”‚   â”‚   â””â”€â”€ display.cc
â”‚   â”œâ”€â”€ application.cc             # é›†æˆåˆ°ä¸»åº”ç”¨
â”‚   â””â”€â”€ CMakeLists.txt             # æ„å»ºé…ç½®
â”‚
â”œâ”€â”€ server/                        # æœåŠ¡ç«¯
â”‚   â”œâ”€â”€ api/                       # APIå±‚
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ questions.py      # é—®é¢˜è®°å½•API
â”‚   â”‚   â”‚   â”œâ”€â”€ summaries.py      # æ€»ç»“ç”ŸæˆAPI
â”‚   â”‚   â”‚   â””â”€â”€ analytics.py      # åˆ†æAPI
â”‚   â”‚   â””â”€â”€ app.py                # FastAPIåº”ç”¨
â”‚   â”‚
â”‚   â”œâ”€â”€ analysis/                  # åˆ†æå±‚
â”‚   â”‚   â”œâ”€â”€ classifier.py          # é—®é¢˜åˆ†ç±»å™¨
â”‚   â”‚   â”œâ”€â”€ interest_analyzer.py  # å…´è¶£åˆ†æ
â”‚   â”‚   â”œâ”€â”€ graph_builder.py      # çŸ¥è¯†å›¾è°±æ„å»º
â”‚   â”‚   â””â”€â”€ gap_detector.py       # çŸ¥è¯†ç¼ºå£æ£€æµ‹
â”‚   â”‚
â”‚   â”œâ”€â”€ generation/                # ç”Ÿæˆå±‚
â”‚   â”‚   â”œâ”€â”€ child_summary.py      # å­©å­ç‰ˆæ€»ç»“
â”‚   â”‚   â”œâ”€â”€ parent_summary.py     # å®¶é•¿ç‰ˆæ€»ç»“
â”‚   â”‚   â””â”€â”€ prompts.py            # Promptæ¨¡æ¿
â”‚   â”‚
â”‚   â”œâ”€â”€ storage/                   # å­˜å‚¨å±‚
â”‚   â”‚   â”œâ”€â”€ database.py           # PostgreSQL
â”‚   â”‚   â”œâ”€â”€ cache.py              # Redis
â”‚   â”‚   â””â”€â”€ graph_db.py           # Neo4j
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                    # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ question.py
â”‚   â”‚   â”œâ”€â”€ session.py
â”‚   â”‚   â””â”€â”€ summary.py
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ nlp.py                # NLPå·¥å…·
â”‚   â”‚   â”œâ”€â”€ time.py               # æ—¶é—´å¤„ç†
â”‚   â”‚   â””â”€â”€ logger.py             # æ—¥å¿—
â”‚   â”‚
â”‚   â”œâ”€â”€ tests/                     # æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_classifier.py
â”‚   â”‚   â”œâ”€â”€ test_analyzer.py
â”‚   â”‚   â””â”€â”€ test_generator.py
â”‚   â”‚
â”‚   â”œâ”€â”€ config.py                  # é…ç½®
â”‚   â”œâ”€â”€ requirements.txt           # ä¾èµ–
â”‚   â””â”€â”€ main.py                    # å…¥å£
â”‚
â”œâ”€â”€ web/                           # å®¶é•¿Webç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ SummaryCard.vue   # æ€»ç»“å¡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ RadarChart.vue    # é›·è¾¾å›¾
â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeGraph.vue # çŸ¥è¯†å›¾è°±
â”‚   â”‚   â”‚   â””â”€â”€ Timeline.vue      # æ—¶é—´çº¿
â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.vue     # ä¸»é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ SummaryDetail.vue # æ€»ç»“è¯¦æƒ…
â”‚   â”‚   â”‚   â””â”€â”€ GrowthReport.vue  # æˆé•¿æŠ¥å‘Š
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ client.js         # APIå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â”‚   â””â”€â”€ index.js          # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ main.js
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.js
â”‚
â”œâ”€â”€ docs/                          # æ–‡æ¡£
â”‚   â”œâ”€â”€ æ€è€ƒä¼™ä¼´åŠŸèƒ½_é¡¹ç›®æ‰‹å†Œ_v1.0.md    # æœ¬æ–‡æ¡£
â”‚   â”œâ”€â”€ api.md                     # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ database.md                # æ•°æ®åº“è®¾è®¡
â”‚   â”œâ”€â”€ deployment.md              # éƒ¨ç½²æŒ‡å—
â”‚   â””â”€â”€ user_guide.md              # ç”¨æˆ·æ‰‹å†Œ
â”‚
â”œâ”€â”€ scripts/                       # è„šæœ¬
â”‚   â”œâ”€â”€ init_db.py                 # åˆå§‹åŒ–æ•°æ®åº“
â”‚   â”œâ”€â”€ migrate.py                 # æ•°æ®è¿ç§»
â”‚   â””â”€â”€ deploy.sh                  # éƒ¨ç½²è„šæœ¬
â”‚
â”œâ”€â”€ docker-compose.yml             # Dockeré…ç½®
â”œâ”€â”€ .env.example                   # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ README.md                      # é¡¹ç›®è¯´æ˜
```

---

## äº”ã€å¼€å‘çºªå¾‹

### 5.1 ä»£ç è§„èŒƒ

#### C++ (ESP32)

```cpp
// å‘½åè§„èŒƒ
class InteractionManager {};  // PascalCase
void RecordQuestion();        // PascalCase
int question_count;           // snake_case
const int MAX_QUESTIONS = 50; // UPPER_SNAKE_CASE

// æ–‡ä»¶ç»„ç»‡
#ifndef THINKING_PARTNER_H_
#define THINKING_PARTNER_H_

namespace ThinkingPartner {
  class InteractionManager {
   public:
    static InteractionManager& GetInstance();
    void RecordQuestion(const std::string& text);
  };
}

#endif  // THINKING_PARTNER_H_
```

#### Python

```python
# å‘½åè§„èŒƒ
class QuestionClassifier:      # PascalCase
    def classify_question(self):  # snake_case
        self.question_count = 0   # snake_case
        MAX_RETRIES = 3            # UPPER_SNAKE_CASE

# ç±»å‹æ³¨è§£
from typing import List, Dict, Optional

def classify_question(question: str) -> Dict[str, any]:
    """åˆ†ç±»é—®é¢˜"""
    if not question:
        raise ValueError("Question cannot be empty")
    return {"type": "why", "category": "ç§‘å­¦"}
```

### 5.2 æµ‹è¯•è¦æ±‚

#### å•å…ƒæµ‹è¯•

```python
# tests/test_classifier.py
import pytest
from analysis.classifier import QuestionClassifier

class TestQuestionClassifier:

    def test_classify_why_question(self, classifier):
        """æµ‹è¯•åˆ†ç±»'why'é—®é¢˜"""
        result = classifier.classify("ä¸ºä»€ä¹ˆå¤©ç©ºæ˜¯è“è‰²çš„ï¼Ÿ")
        assert result["question_type"] == "why"
        assert result["main_category"] == "ç§‘å­¦"

    def test_classify_empty_question(self, classifier):
        """æµ‹è¯•ç©ºé—®é¢˜å¼‚å¸¸"""
        with pytest.raises(ValueError):
            classifier.classify("")
```

#### é›†æˆæµ‹è¯•

```python
# tests/integration/test_api.py
from fastapi.testclient import TestClient
from api.app import app

client = TestClient(app)

def test_record_question():
    """æµ‹è¯•è®°å½•é—®é¢˜API"""
    response = client.post("/api/v1/questions", json={
        "question_text": "ä¸ºä»€ä¹ˆå¤©ç©ºæ˜¯è“è‰²çš„ï¼Ÿ",
        "child_id": "test_child"
    })

    assert response.status_code == 200
    data = response.json()
    assert "question_id" in data
```

### 5.3 æ–‡æ¡£è¦æ±‚

#### ä»£ç æ–‡æ¡£

```python
def calculate_interest_heat(child_id: str, days: int = 7) -> List[Dict]:
    """è®¡ç®—ä¸»é¢˜çƒ­åº¦ã€‚

    çƒ­åº¦å…¬å¼ï¼šçƒ­åº¦ = æé—®æ¬¡æ•°(40%) + å¹³å‡æ·±åº¦(30%) + æ–°é²œåº¦(30%)

    Args:
        child_id: å­©å­ID
        days: ç»Ÿè®¡å¤©æ•°ï¼Œé»˜è®¤7å¤©

    Returns:
        æŒ‰çƒ­åº¦æ’åºçš„ä¸»é¢˜åˆ—è¡¨

    Raises:
        DatabaseError: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥
    """
    pass
```

#### APIæ–‡æ¡£

```yaml
# OpenAPIè§„èŒƒ
/api/v1/questions:
  post:
    summary: è®°å½•é—®é¢˜
    tags:
      - Data Collection
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - question_text
              - child_id
            properties:
              question_text:
                type: string
                example: "ä¸ºä»€ä¹ˆå¤©ç©ºæ˜¯è“è‰²çš„ï¼Ÿ"
              child_id:
                type: string
                example: "child_001"
    responses:
      '200':
        description: æˆåŠŸè®°å½•
```

### 5.4 Gitå·¥ä½œæµ

```bash
# åˆ†æ”¯ç­–ç•¥
main        # ç”Ÿäº§ç¯å¢ƒ
develop     # å¼€å‘ç¯å¢ƒ
feature/*   # åŠŸèƒ½åˆ†æ”¯
hotfix/*    # ç´§æ€¥ä¿®å¤

# æäº¤è§„èŒƒ
git commit -m "feat(question_classifier): add support for 'compare' type

- Implement pattern matching for comparison questions
- Add unit tests
- Update documentation

Closes #123"

# å¸¸ç”¨å‘½ä»¤
git checkout -b feature/interest-analyzer
git add .
git commit -m "feat: add interest analyzer"
git push origin feature/interest-analyzer
# åˆ›å»ºPRï¼Œä»£ç å®¡æŸ¥ååˆå¹¶åˆ°develop
```

### 5.5 éƒ¨ç½²è§„èŒƒ

```bash
# ç¯å¢ƒé…ç½®
# .env.production
DATABASE_URL=postgresql://user:pass@host:5432/db
REDIS_URL=redis://host:6379/0
OPENAI_API_KEY=sk-...
LOG_LEVEL=INFO

# Dockeréƒ¨ç½²
docker-compose up -d

# æ•°æ®è¿ç§»
python scripts/migrate.py

# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# å›æ»š
docker-compose down
git checkout previous_version
docker-compose up -d
```

---

**æ–‡æ¡£ç»“æŸ** âœ…

è¿™ä¸ªæ‰‹å†Œæä¾›äº†å®Œæ•´çš„æŠ€æœ¯è§„èŒƒï¼Œå¼€å‘å›¢é˜Ÿåº”è¯¥ä¸¥æ ¼æŒ‰ç…§æ­¤è§„èŒƒå®æ–½ã€‚å¦‚æœæœ‰ä»»ä½•ç–‘é—®æˆ–éœ€è¦è¡¥å……çš„åœ°æ–¹ï¼Œè¯·åŠæ—¶æå‡ºã€‚
