<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>测试设备API</title>
</head>
<body>
    <h1>设备API测试</h1>
    <div id="result">加载中...</div>
    
    <script>
        const API_BASE = 'http://120.25.213.109:8081/api';
        const token = localStorage.getItem('session_token');
        
        if (!token) {
            document.getElementById('result').innerHTML = '<p style="color: red;">错误: 未找到session_token</p>';
            document.getElementById('result').innerHTML += '<p>请先访问 <a href="/static/auth.html">登录页面</a></p>';
        } else {
            document.getElementById('result').innerHTML = '<p>Token: ' + token.substring(0, 20) + '...</p>';
            document.getElementById('result').innerHTML += '<p>正在调用 API...</p>';
            
            fetch(API_BASE + '/user/devices', {
                headers: { 'Authorization': 'Bearer ' + token }
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById('result').innerHTML = '<h2>API返回结果:</h2>';
                document.getElementById('result').innerHTML += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            })
            .catch(err => {
                document.getElementById('result').innerHTML = '<p style="color: red;">错误: ' + err + '</p>';
            });
        }
    </script>
</body>
</html>
